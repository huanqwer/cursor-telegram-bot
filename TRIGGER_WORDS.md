# 项目触发词功能使用指南

## 功能概述

Telegram Bot 现在支持通过触发词快速切换项目。发送触发词后，Bot 会记住你选择的项目，后续所有消息都会自动在该项目下执行，直到你切换项目或记忆过期（第二天0点后）。

## 支持的触发词

### link-all（后端项目）
- `link-all`
- `后端项目`
- `后端工程`
- `后端`

### link-core-web（网页端）
- `link-core-web`
- `网页端`

### link-core（前端项目）
- `link-core`
- `前端`
- `前端工程`
- `前端项目`

### menghaoke（资料项目）
- `menghaoke`
- `资料项目`
- `资料工程`

### my-todo（待办项目）
- `my-todo`
- `待办项目`
- `待办`
- `待办工程`

## 使用方法

### 1. 切换项目

发送触发词即可切换项目，支持两种格式：

**单独触发词**：
```
my-todo
后端
前端
待办
```

**带"切换到"前缀**：
```
切换到my-todo
切换到后端
切换到前端
切换到待办
```

Bot 会回复确认消息：
```
✅ 已切换到项目：my-todo
路径：<你的项目路径>

后续消息将自动使用此项目。
```

### 2. 执行任务

切换项目后，直接发送任务描述即可，Bot 会自动使用记忆的项目：

```
列出文件
添加新功能
修复bug
```

Bot 会自动在记忆的项目下执行任务，相当于：
```
--project <项目路径> 列出文件
```

### 3. 未选择项目

如果没有选择项目就发送任务，Bot 会提示你选择项目：

```
您还没有选择操作哪个项目：

- 触发词与路径由 `config/bot_config.json` 的 `project_trigger_mapping` 配置（格式见 README）

请发送触发词切换项目（如：my-todo 或 切换到后端）
```

## 记忆机制

- **记忆有效期**：选择项目后，记忆会保持到当天结束（第二天0点后自动失效）
- **自动切换**：发送新的触发词会立即更新记忆
- **手动覆盖**：如果消息中包含 `--project` 参数，会优先使用参数指定的项目

## 示例流程

1. **切换项目**：
   ```
   用户：切换到后端
   Bot：✅ 已切换到项目：后端
        路径：<项目路径>
        后续消息将自动使用此项目。
   ```

2. **执行任务**：
   ```
   用户：列出所有文件
   Bot：⏳ 正在执行任务...
       （在 link-all 项目下执行）
   ```

3. **切换其他项目**：
   ```
   用户：前端
   Bot：✅ 已切换到项目：前端
        路径：<项目路径>
        后续消息将自动使用此项目。
   ```

4. **继续执行任务**：
   ```
   用户：检查代码风格
   Bot：⏳ 正在执行任务...
       （现在在 link-core 项目下执行）
   ```

## 注意事项

1. **记忆过期**：如果第二天使用 Bot，需要重新选择项目
2. **项目路径**：确保项目路径存在且可访问
3. **触发词大小写**：触发词匹配不区分大小写（但建议使用小写）
4. **特殊字符**：触发词中的中文字符和连字符都会被正确识别

## 技术实现

- **项目映射**：`bot/project_manager.py`（从 `config/bot_config.json` 的 `project_trigger_mapping` 读取）
- **会话管理**：`bot/session_manager.py`
- **数据存储**：`data/user_sessions.json`
